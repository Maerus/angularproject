{"version":3,"sources":["app.min.js"],"names":["MyApp","angular","module","config","$stateProvider","$urlRouterProvider","otherwise","state","url","templateUrl","controller","controllerAs","user","userName","setName","name","this","getName","$scope","$stateParams","$timeout","chatName","firebase","database","ref","on","snapshot","messages","val","updateScroll","chatmessage","username","$watch","length","document","getElementById","disabled","$","focus","sendMessage","timestamp","Date","now","push","member","message","set","lastMessage","messager","enterToSend","event","key","chatmessageHeight","height","Object","keys","animate","scrollTop","enterChat","window","location","href","chatroom","directive","objects","array","o","channel","sort","a","b","freshChats","slice","console","log","filter","toggleFilter"],"mappings":"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","file":"app.min.js","sourcesContent":["var MyApp = angular.module(\"MyApp\", [\"ui.router\"]);\n\nMyApp.config([\"$stateProvider\", \"$urlRouterProvider\", function($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/home\");\n\n  $stateProvider\n    .state(\"main\", {\n      url: \"/\",\n      templateUrl: \"templates/main/main.html\",\n      controller: \"MainController\",\n      controllerAs: \"main\"\n    })\n    .state(\"main.home\", {\n      url: \"home\",\n      templateUrl: \"templates/home/home.html\",\n    })/*\n    .state(\"main.login\", {\n      url: \"login\",\n      templateUrl: \"templates/login/login.html\",\n    })*/\n    .state(\"chat\", {\n      url: \"/chat\",\n      templateUrl: \"templates/main/main.html\"\n    })\n\t.state(\"chat.room\",{\n\t\turl: \"/:chatName\",\n\t\ttemplateUrl: \"templates/chat/chatroom.html\",\n\t  controller: \"ChatController\",\n\t  controllerAs: \"chat\"\r\n\t})\n\t.state(\"main.channel\", {\n\t\turl: \"room\",\n\t\ttemplateUrl: \"templates/chat_select/room.html\",\n\t\tcontroller: \"RoomController\",\n\t\tcontrollerAs: \"room\"\n\t})\n}]);\n\nvar user = {};\nuser.userName = \"\";\nuser.setName = function(name){\n\tthis.userName = name;\n}\nuser.getName = function(){\n\treturn this.userName;\r\n}\nMyApp.controller(\"ChatController\", [\"$scope\", \"$stateParams\", \"$timeout\", function($scope, $stateParams, $timeout) {\r\n\tif($stateParams){\r\n\t\t$scope.chatName = $stateParams.chatName;\r\n\t\tif($scope.chatName != \"\"){\r\n\t\t\tfirebase.database().ref('/messages/' + $scope.chatName).on('value', function(snapshot){\r\n\t\t\t\t$timeout(function() {\r\n\t\t\t\t\t$scope.messages = snapshot.val();\r\n\t\t\t\t\t$scope.updateScroll();\r\n\t\t\t\t}, 0);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t$scope.chatmessage = \"\";\r\n\t$scope.username = user.getName();\r\n\t$scope.$watch('username', function() {\r\n\t\tuser.setName($scope.username);\r\n\t\tif($scope.chatmessage.length > 0 && $scope.username.length > 1){\r\n\t\t\tdocument.getElementById(\"send\").disabled = false;\r\n\t\t} else {\r\n\t\t\tdocument.getElementById(\"send\").disabled = true;\r\n\t\t}\r\n    });\r\n\t$scope.$watch('chatmessage', function() {\r\n\t\tif($scope.chatmessage.length > 0 && $scope.username.length > 1){\r\n\t\t\tdocument.getElementById(\"send\").disabled = false;\r\n\t\t} else {\r\n\t\t\tdocument.getElementById(\"send\").disabled = true;\r\n\t\t}\r\n\t});\r\n\t$scope.$watch('messages', function(){\r\n\t\t$scope.updateScroll();\r\n\t});\r\n\t\r\n\t$(\"#message\").focus();\r\n\t\r\n\t$scope.sendMessage = function(){\r\n\t\tif($scope.chatName != \"\"){\r\n\t\t\tvar timestamp = Date.now();\r\n\t\t\tfirebase.database().ref('/messages/' + $scope.chatName).push({\r\n\t\t\t\tmember: $scope.username,\r\n\t\t\t\tmessage: $scope.chatmessage,\r\n\t\t\t\ttimestamp: timestamp\r\n\t\t\t});\r\n\t\t\tfirebase.database().ref('/chats/' + $scope.chatName).set({\r\n\t\t\t\tlastMessage: $scope.chatmessage,\r\n\t\t\t\tmessager: $scope.username,\r\n\t\t\t\ttimestamp: timestamp\r\n\t\t\t});\r\n\t\t}\r\n\t\t$scope.chatmessage = \"\";\r\n\t\t$(\"#message\").focus();\r\n\t}\r\n\t\r\n\t$scope.enterToSend = function(event){\r\n\t\tif(event.key == \"Enter\" && !document.getElementById(\"send\").disabled){\r\n\t\t\t$scope.sendMessage();\r\n\t\t}\r\n\t}\r\n\t\r\n\tvar chatmessageHeight = 50; \r\n\t//26 oikea koko atm, en saa jostain syyst채 kaivettua sit채 documentista mutta eip채h채n hajoa\r\n\t\r\n\t$scope.updateScroll = function(){\r\n\t\tvar height = Object.keys($scope.messages).length * chatmessageHeight;\r\n\t\t$(\"#chatbox\").animate({scrollTop: height});\r\n\t}\r\n}])\nMyApp.controller(\"RoomController\", [\"$scope\", \"$timeout\", function($scope, $timeout) {\r\n\t$scope.username = user.getName();\r\n\t$scope.$watch('username', function() {\r\n\t\tuser.setName($scope.username);\r\n    });\r\n\t\r\n\t$scope.enterChat = function(event){\r\n\t\tif(event.key == \"Enter\"){\r\n\t\t\twindow.location.href = \"#/chat/\"+$scope.chatroom;\r\n\t\t}\r\n\t}\r\n}])\r\n\nMyApp.directive(\"navTop\", function() {\n  return {\n    templateUrl: \"templates/layout-directives/nav-top2.html\",\n  };\n});\n\nMyApp.controller(\"MainController\", [\"$scope\", \"$timeout\", function($scope, $timeout) {\n\tfirebase.database().ref('/chats/').on('value', function(snapshot){\n\t\t$timeout(function() {\n\t\t\tvar objects = snapshot.val();\n\t\t\tarray = [];\n\t\t\tfor (var key in objects){\n\t\t\t\tvar o = {};\n\t\t\t\to.channel = key;\n\t\t\t\to.timestamp = objects[key].timestamp;\n\t\t\t\to.lastMessage = objects[key].lastMessage;\n\t\t\t\to.messager = objects[key].messager;\n\t\t\t\tarray.push(o);\r\n\t\t\t}\n\t\t\tarray.sort(function(a, b){return b.timestamp-a.timestamp})\n\t\t\t$scope.freshChats = array.slice(0, 20)\n\t\t\tconsole.log($scope.freshChats);\r\n\t\t}, 0);\r\n\t});\n}])\n\nMyApp.controller(\"OtherController\", [\"$scope\", function($scope) {\n  $scope.filter = true;\n  $scope.toggleFilter = function() {\n    $scope.filter = !$scope.filter;\n  }\n}])\n\nMyApp.controller(\"LoginController\", function() {\n\n})\n\nMyApp.controller(\"StuffController\", function() {\n\n})\n"],"sourceRoot":"/source/"}