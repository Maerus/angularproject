var MyApp=angular.module("MyApp",["ui.router"]);MyApp.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/home"),e.state("main",{url:"/",templateUrl:"templates/main/main.html",controller:"MainController",controllerAs:"main"}).state("main.home",{url:"home",templateUrl:"templates/home/home.html"}).state("chat",{url:"/chat",templateUrl:"templates/main/main.html"}).state("chat.room",{url:"/:chatName",templateUrl:"templates/chat/chatroom.html",controller:"ChatController",controllerAs:"chat"}).state("main.channel",{url:"room",templateUrl:"templates/chat_select/room.html",controller:"RoomController",controllerAs:"room"})}]);var user={};user.userName="",user.setName=function(e){this.userName=e},user.getName=function(){return this.userName},MyApp.controller("ChatController",["$scope","$stateParams","$timeout",function(e,t,a){t&&(e.chatName=t.chatName,""!=e.chatName&&firebase.database().ref("/messages/"+e.chatName).on("value",function(t){a(function(){e.messages=t.val(),e.updateScroll()},0)})),e.chatmessage="",e.username=user.getName(),e.$watch("username",function(){user.setName(e.username),e.chatmessage.length>0&&e.username.length>1?document.getElementById("send").disabled=!1:document.getElementById("send").disabled=!0}),e.$watch("chatmessage",function(){e.chatmessage.length>0&&e.username.length>1?document.getElementById("send").disabled=!1:document.getElementById("send").disabled=!0}),e.$watch("messages",function(){e.updateScroll()}),$("#message").focus(),e.sendMessage=function(){if(""!=e.chatName){var t=Date.now();firebase.database().ref("/messages/"+e.chatName).push({member:e.username,message:e.chatmessage,timestamp:t}),firebase.database().ref("/chats/"+e.chatName).set({lastMessage:e.chatmessage,messager:e.username,timestamp:t})}e.chatmessage="",$("#message").focus()},e.enterToSend=function(t){"Enter"!=t.key||document.getElementById("send").disabled||e.sendMessage()};var s=50;e.updateScroll=function(){var t=Object.keys(e.messages).length*s;$("#chatbox").animate({scrollTop:t})}}]),MyApp.controller("RoomController",["$scope","$timeout",function(e,t){e.username=user.getName(),e.$watch("username",function(){user.setName(e.username)}),e.enterChat=function(t){"Enter"==t.key&&(window.location.href="#/chat/"+e.chatroom)}}]),MyApp.directive("navTop",function(){return{templateUrl:"templates/layout-directives/nav-top2.html"}}),MyApp.controller("MainController",["$scope","$timeout",function(e,t){firebase.database().ref("/chats/").on("value",function(a){t(function(){var t=a.val();array=[];for(var s in t){var r={};r.channel=s,r.timestamp=t[s].timestamp,r.lastMessage=t[s].lastMessage,r.messager=t[s].messager,array.push(r)}array.sort(function(e,t){return t.timestamp-e.timestamp}),e.freshChats=array.slice(0,20),console.log(e.freshChats)},0)})}]),MyApp.controller("OtherController",["$scope",function(e){e.filter=!0,e.toggleFilter=function(){e.filter=!e.filter}}]),MyApp.controller("LoginController",function(){}),MyApp.controller("StuffController",function(){});
//# sourceMappingURL=app.min.js.map
